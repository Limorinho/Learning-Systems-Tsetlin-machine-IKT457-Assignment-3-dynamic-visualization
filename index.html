<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Literal Automaton - Stationary Distribution Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .slider-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .slider-item {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        .slider-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #ddd;
            outline: none;
            border-radius: 5px;
            margin: 10px 0;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
        .value-display {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }
        .derived-params {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .derived-params h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .description {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }
        .description h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        #chart {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Literal Automaton - Stationary Distribution Visualization</h1>
        
        <div class="slider-container">
            <div class="slider-item">
                <div class="slider-label">s (Strength parameter):</div>
                <input type="range" min="1" max="25" value="5" step="0.1" class="slider" id="s-slider">
                <div class="value-display" id="s-value">5.0</div>
            </div>
            
            <div class="slider-item">
                <div class="slider-label">P(L|Y) (Probability of L given Y):</div>
                <input type="range" min="0" max="1" value="0.8" step="0.01" class="slider" id="p-l-given-y-slider">
                <div class="value-display" id="p-l-given-y-value">0.80</div>
            </div>
            
            <div class="slider-item">
                <div class="slider-label">P(Y) (Probability of Y):</div>
                <input type="range" min="0" max="1" value="0.6" step="0.01" class="slider" id="p-y-slider">
                <div class="value-display" id="p-y-value">0.60</div>
            </div>
            
            <div class="slider-item">
                <div class="slider-label">P(~L|~Y) (Probability of not L given not Y):</div>
                <input type="range" min="0" max="1" value="0.7" step="0.01" class="slider" id="p-not-l-given-not-y-slider">
                <div class="value-display" id="p-not-l-given-not-y-value">0.70</div>
            </div>
        </div>
        
        <div class="derived-params">
            <h3>Derived Parameters:</h3>
            <div id="derived-params-content"></div>
        </div>
        
        <div id="chart"></div>
        
        <div class="description">
            <h3>Model Description:</h3>
            <p>
                This visualization shows the stationary distribution of a Literal Automaton with 8 states.
                The eight states represent all possible combinations of three binary variables: Y, L, and their histories.
                The height of each bar represents the long-run probability of being in that state.
            </p>
            <p><strong>Parameters:</strong></p>
            <ul>
                <li><strong>s:</strong> Strength parameter affecting the learning dynamics</li>
                <li><strong>P(L|Y):</strong> Probability of literal response given Y is true</li>
                <li><strong>P(Y):</strong> Base probability that Y is true</li>
                <li><strong>P(~L|~Y):</strong> Probability of not giving literal response when Y is false</li>
                <li><strong>P(~L|Y) = 1 - P(L|Y):</strong> Automatically calculated</li>
                <li><strong>P(~Y) = 1 - P(Y):</strong> Automatically calculated</li>
            </ul>
        </div>
    </div>

    <script>
        function calculateStationaryDistribution(s, pLGivenY, pY, pNotLGivenNotY) {
            // Calculate derived probabilities
            const nLGivenY = 1.0 - pLGivenY;  // P(~L|Y)
            const nY = 1.0 - pY;  // P(~Y)
            
            // Calculate the big equation: P(L|Y)*P(Y) + P(~L|~Y)*P(~Y)
            const bigEq = pLGivenY * pY + pNotLGivenNotY * nY;
            
            // Calculate each unnormalized probability according to the exact equations from the assignment
            const pi1 = Math.pow(pY, 4) * Math.pow(pLGivenY, 0) * Math.pow(nLGivenY, 7) * Math.pow(s, 0) * Math.pow(bigEq, 0);
            const pi2 = Math.pow(pY, 3) * Math.pow(pLGivenY, 0) * Math.pow(nLGivenY, 6) * Math.pow(s, 1) * Math.pow(bigEq, 1);
            const pi3 = Math.pow(pY, 2) * Math.pow(pLGivenY, 0) * Math.pow(nLGivenY, 5) * Math.pow(s, 2) * Math.pow(bigEq, 2);
            const pi4 = Math.pow(pY, 1) * Math.pow(pLGivenY, 0) * Math.pow(nLGivenY, 4) * Math.pow(s, 3) * Math.pow(bigEq, 3);
            const pi5 = Math.pow(pY, 0) * Math.pow(pLGivenY, 0) * Math.pow(nLGivenY, 3) * Math.pow(s, 4) * Math.pow(bigEq, 4);
            const pi6 = Math.pow(pY, 0) * Math.pow(pLGivenY, 1) * Math.pow(nLGivenY, 2) * Math.pow(s, 5) * Math.pow(bigEq, 4);
            const pi7 = Math.pow(pY, 0) * Math.pow(pLGivenY, 2) * Math.pow(nLGivenY, 1) * Math.pow(s, 6) * Math.pow(bigEq, 4);
            const pi8 = Math.pow(pY, 0) * Math.pow(pLGivenY, 3) * Math.pow(nLGivenY, 0) * Math.pow(s, 7) * Math.pow(bigEq, 4);
            
            // Calculate normalization constant
            const totalUnnorm = pi1 + pi2 + pi3 + pi4 + pi5 + pi6 + pi7 + pi8;
            
            // Calculate normalized probabilities
            const distribution = [pi1, pi2, pi3, pi4, pi5, pi6, pi7, pi8].map(pi => pi / totalUnnorm);
            
            return distribution;
        }

        function updateChart() {
            const s = parseFloat(document.getElementById('s-slider').value);
            const pLGivenY = parseFloat(document.getElementById('p-l-given-y-slider').value);
            const pY = parseFloat(document.getElementById('p-y-slider').value);
            const pNotLGivenNotY = parseFloat(document.getElementById('p-not-l-given-not-y-slider').value);
            
            // Update value displays
            document.getElementById('s-value').textContent = s.toFixed(1);
            document.getElementById('p-l-given-y-value').textContent = pLGivenY.toFixed(2);
            document.getElementById('p-y-value').textContent = pY.toFixed(2);
            document.getElementById('p-not-l-given-not-y-value').textContent = pNotLGivenNotY.toFixed(2);
            
            // Calculate derived parameters
            const pNotLGivenY = 1 - pLGivenY;
            const pNotY = 1 - pY;
            const pLGivenNotY = 1 - pNotLGivenNotY;
            const baseExpr = pLGivenY * pY + pLGivenNotY * pNotY;
            
            // Update derived parameters display
            const derivedParamsContent = document.getElementById('derived-params-content');
            derivedParamsContent.innerHTML = `
                <p style="margin: 2px 0;">P(~L|Y) = 1 - P(L|Y) = ${pNotLGivenY.toFixed(3)}</p>
                <p style="margin: 2px 0;">P(~Y) = 1 - P(Y) = ${pNotY.toFixed(3)}</p>
                <p style="margin: 2px 0;">P(L|~Y) = 1 - P(~L|~Y) = ${pLGivenNotY.toFixed(3)}</p>
                <p style="margin: 2px 0;">Base expression = P(L|Y)P(Y) + P(L|~Y)P(~Y) = ${baseExpr.toFixed(3)}</p>
            `;
            
            // Calculate stationary distribution using exact equations
            const stationaryDist = calculateStationaryDistribution(s, pLGivenY, pY, pNotLGivenNotY);
            
            // Create colors for forgotten vs memorized states
            const colors = ['lightblue', 'lightblue', 'lightblue', 'lightblue', 
                           'mediumpurple', 'mediumpurple', 'mediumpurple', 'mediumpurple'];
            
            // Create the bar chart
            const data = [{
                x: [1, 2, 3, 4, 5, 6, 7, 8],
                y: stationaryDist,
                type: 'bar',
                text: stationaryDist.map(prob => prob.toFixed(4)),
                textposition: 'outside',
                marker: {
                    color: colors
                },
                hovertemplate: '<b>π%{x}</b><br>Probability: %{y:.6f}<extra></extra>'
            }];
            
            const layout = {
                title: 'Interactive Stationary Distribution Chart',
                xaxis: {
                    title: '',
                    tickmode: 'array',
                    tickvals: [1, 2, 3, 4, 5, 6, 7, 8],
                    ticktext: ['1', '2', '3', '4', '5', '6', '7', '8']
                },
                yaxis: {
                    title: 'π',
                    range: [0, Math.max(...stationaryDist) * 1.3]
                },
                height: 500,
                showlegend: false,
                annotations: [
                    {
                        x: 2.5,
                        y: Math.max(...stationaryDist.slice(0, 4)) + Math.max(...stationaryDist) * 0.1,
                        text: "Forgotten",
                        showarrow: false,
                        font: {size: 14, color: "gray"}
                    },
                    {
                        x: 6.5,
                        y: Math.max(...stationaryDist.slice(4, 8)) + Math.max(...stationaryDist) * 0.1,
                        text: "Memorized",
                        showarrow: false,
                        font: {size: 14, color: "gray"}
                    }
                ],
                shapes: [
                    {
                        type: 'line',
                        x0: 4.5,
                        y0: 0,
                        x1: 4.5,
                        y1: Math.max(...stationaryDist) * 1.3,
                        line: {
                            color: 'gray',
                            width: 2,
                            dash: 'dash'
                        },
                        opacity: 0.5
                    }
                ],
                plot_bgcolor: 'white',
                paper_bgcolor: 'white'
            };
            
            Plotly.newPlot('chart', data, layout);
        }

        // Add event listeners for sliders
        document.getElementById('s-slider').addEventListener('input', updateChart);
        document.getElementById('p-l-given-y-slider').addEventListener('input', updateChart);
        document.getElementById('p-y-slider').addEventListener('input', updateChart);
        document.getElementById('p-not-l-given-not-y-slider').addEventListener('input', updateChart);
        
        // Initial chart render
        updateChart();
    </script>
</body>
</html>
``` 